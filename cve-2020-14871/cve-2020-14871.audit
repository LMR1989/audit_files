# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This .audit addresses a temporary stop gap in targets where the patch is not installed or feasible to install in a timely manner.
#
# Sources for additional information:
#   https://www.tenable.com/blog/ (Need to update)
#   https://www.tenable.com/cve/CVE-2020-14871
#   https://www.fireeye.com/blog/threat-research/2020/11/live-off-the-land-an-overview-of-unc1945.html
#   https://www.fireeye.com/blog/threat-research/2020/11/critical-buffer-overflow-vulnerability-in-solaris-can-allow-remote-takeover.html
#

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "Solaris 9, 10, or 11 is installed"
      file        : "/etc/release"
      regex       : ".*Solaris[\\s]+(9|10|11)"
      expect      : ".*Solaris[\\s]+(9|10|11)"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      system          : "SunOS"
      type            : FILE_CONTENT_CHECK
      description     : "CVE-2020-14871 - Check if ChallengeResponseAuthentication is set to no and not commented."
      info            : "This check looks for the existence of a temporary workaround advised by FireEye for SSH exploit paths until CVE-2020-14871 patches are in place."
      solution        : "Modify the /etc/ssh/sshd_config file to include the line 'ChallengeResponseAuthentication no'."
      see_also        : "https://www.fireeye.com/blog/threat-research/2020/11/critical-buffer-overflow-vulnerability-in-solaris-can-allow-remote-takeover.html"
      file            : "/etc/ssh/sshd_config"
      regex           : "^[\\s]*ChallengeResponseAuthentication[\\s]+"
      expect          : "^[\\s]*ChallengeResponseAuthentication[\\s]+no[\\s]*$"
      string_required : YES
    </custom_item>

    <custom_item>
      system          : "SunOS"
      type            : FILE_CONTENT_CHECK
      description     : "CVE-2020-14871 - Check if KbdInteractiveAuthentication is set to no and not commented."
      info            : "This check looks for the existence of a temporary workaround advised by FireEye for SSH exploit paths until CVE-2020-14871 patches are in place."
      solution        : "Modify the /etc/ssh/sshd_config file to include the line 'KbdInteractiveAuthentication no'."
      see_also        : "https://www.fireeye.com/blog/threat-research/2020/11/critical-buffer-overflow-vulnerability-in-solaris-can-allow-remote-takeover.html"
      file            : "/etc/ssh/sshd_config"
      regex           : "^[\\s]*KbdInteractiveAuthentication[\\s]+"
      expect          : "^[\\s]*KbdInteractiveAuthentication[\\s]+no[\\s]*$"
      string_required : YES
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "Solaris 9, 10, or 11 is not installed on target and CVE-2020-14871 does not apply."
      info        : "Solaris 9, 10, or 11 is not installed on target and CVE-2020-14871 does not apply."
    </report>
  </else>
</if>

</check_type>
