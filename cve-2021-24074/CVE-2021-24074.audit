# This script is Copyright (C) 2004-2021 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This .audit addresses a temporary stop gap in targets where the patch is not installed or feasible to install in a timely manner.
#
# Sources for additional information:
#   https://msrc-blog.microsoft.com/2021/02/09/multiple-security-updates-affecting-tcp-ip/
#   https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-24074
#   https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24074

<check_type:"Windows" version:"2">
<group_policy:"Windows">

<custom_item>
  type        : REGISTRY_SETTING
  description : "CVE-2021-24074 - Ensure 'MSS: (DisableIPSourceRouting) IP source routing protection level (protects against packet spoofing)' is set to 'Enabled: Highest protection, source routing is completely disabled'"
  info        : "This check looks for the existence of a temporary workaround advised by Microsoft for a Critical Remote Code Execution (RCE) vulnerability until CVE-2021-24074 patches are in place."
  solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled: Highest protection, source routing is completely disabled:

Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (DisableIPSourceRouting) IP source routing protection level (protects against packet spoofing)

Note: This Group Policy path does not exist by default. An additional Group Policy template (MSS-legacy.admx/adml) is required - it is available from this TechNet blog post: The MSS settings - Microsoft Security Guidance blog"
  see_also    : "https://msrc-blog.microsoft.com/2021/02/09/multiple-security-updates-affecting-tcp-ip/"
  value_type  : POLICY_DWORD
  value_data  : "2"
  reg_key     : "HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters"
  reg_item    : "DisableIPSourceRouting"
  reg_option  : CAN_NOT_BE_NULL
</custom_item>

</group_policy>
</check_type>
